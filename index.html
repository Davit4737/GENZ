<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GENZ — Presale</title>
  <meta name="description" content="GENZ — meme coin. Presale landing (HTML/CSS/JS)." />
  <meta name="robots" content="noindex,nofollow" />

  <script>
  /* Сделает круглый favicon */
  (function makeRoundedFavicon(src = './img/IMG_0605.PNG', size = 128, border = 4, borderColor = '#88A7C8') {
    function setFaviconDataURL(dataUrl) {
      let link = document.querySelector("link[rel~='icon']");
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.getElementsByTagName('head')[0].appendChild(link);
      }
      link.type = 'image/png';
      link.href = dataUrl;
    }
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = size; canvas.height = size;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,size,size);
      const cx = size/2, cy = size/2, radius = (size/2)-border;
      ctx.save();
      ctx.beginPath(); ctx.arc(cx, cy, radius, 0, Math.PI*2); ctx.closePath(); ctx.clip();
      const arImg = img.width/img.height, arCan = 1;
      let dw=size, dh=size, dx=0, dy=0;
      if (arImg>arCan){ dh=size; dw=Math.round(size*arImg); dx=Math.round((size-dw)/2); }
      else { dw=size; dh=Math.round(size/arImg); dy=Math.round((size-dh)/2); }
      ctx.drawImage(img, dx, dy, dw, dh);
      ctx.restore();
      if (border>0){ ctx.beginPath(); ctx.arc(cx, cy, radius, 0, Math.PI*2); ctx.lineWidth = border*2; ctx.strokeStyle = borderColor; ctx.stroke(); }
      try {
        const dataUrl = canvas.toDataURL('image/png');
        setFaviconDataURL(dataUrl);
        let sc = document.querySelector("link[rel='shortcut icon']");
        if (!sc) { sc = document.createElement('link'); sc.rel = 'shortcut icon'; document.head.appendChild(sc); }
        sc.href = dataUrl;
      } catch (err) {
        console.warn('Could not create rounded favicon', err);
        setFaviconDataURL(src + (src.indexOf('?') === -1 ? '?v=1' : '&v=1'));
      }
    };
    img.onerror = (e) => { console.warn('Failed to load favicon source:', src, e); };
    img.src = src;
  })();
  </script>

  <style>
    :root{
      --bg1:#0f1724; --muted-weak:rgba(255,255,255,0.60);
      --card-bg: rgba(6,10,20,0.62);
      --yellow-1:#ffd60a; --yellow-2:#ffb300;
      --maxw:1100px;
      --accent:#7dd3fc;
      --panel-bg:#071025;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#fff;background-color:var(--bg1);position:relative;overflow-x:hidden}
    .bg{position:fixed;inset:0;background-image:url('./img/IMG_0606.PNG');background-size:cover;background-position:center;z-index:0;filter:saturate(0.9) contrast(0.9);transform:translateZ(0)}
    .bg::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.75),rgba(2,8,25,0.85));z-index:1;pointer-events:none}
    .wrap{max-width:var(--maxw);margin:28px auto;padding:24px;position:relative;z-index:2}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:6px}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:86px;height:86px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:2px solid rgba(255,255,255,0.06)}
    .logo img{width:100%;height:100%;object-fit:cover;display:block}
    .brand .title{font-weight:800;font-size:16px}
    nav{display:flex;gap:14px;align-items:center}
    nav a{color:var(--muted-weak);text-decoration:none;font-size:14px;padding:8px 10px;border-radius:10px;transition:all .18s}
    .btn{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--yellow-1),var(--yellow-2));color:#0b1220;font-weight:800;padding:10px 18px;border-radius:14px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr;gap:24px;margin-top:6px}
    @media(min-width:960px){.grid{grid-template-columns:1fr 420px}}
    .card{background:var(--card-bg);border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6);backdrop-filter:blur(6px)}
    h1{margin:0;font-size:34px}
    p.lead{color:var(--muted-weak);margin-top:8px}
    .stats{display:flex;gap:12px;margin-top:16px}
    .stat{background: rgba(3,6,13,0.48); padding:12px;border-radius:10px;flex:1}
    .progress{margin-top:14px}
    .bar{height:12px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;border:1px solid rgba(0,0,0,0.35)}
    .bar-inner{height:100%;width:0;background:linear-gradient(90deg,var(--yellow-1),var(--yellow-2));transition:width .9s}
    .bar-row{display:flex;justify-content:space-between;font-size:13px;color:var(--muted-weak);margin-top:8px}
    .countdown{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .tiers{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .tier{display:flex;justify-content:space-between;align-items:center;padding:12px;background: rgba(3,6,13,0.45);border-radius:12px}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px;color:var(--muted-weak)}
    td,th{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03)}
    footer{color:var(--muted-weak);font-size:13px;margin-top:18px;text-align:center}
    .input{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.25);color:#fff;flex:1}
    @media(max-width:600px){h1{font-size:22px}.logo{width:64px;height:64px}}

    /* modal styles minimal */
    .genz-modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
    .genz-modal{width:520px;max-width:95%;background:var(--panel-bg);border-radius:12px;padding:18px;color:#fff;position:relative;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
    .genz-close{position:absolute;right:12px;top:8px;cursor:pointer;color:#ffd60a;font-weight:700}
    .genz-input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;margin-top:8px}
    .genz-btn{padding:10px 12px;border-radius:10px;background:linear-gradient(135deg,#ffd60a,#ffb300);border:0;cursor:pointer;font-weight:700}
    .genz-secondary{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer;color:#fff;margin-left:8px}
    .genz-small{font-size:13px;color:rgba(255,255,255,0.75);margin-top:8px}
    .genz-warn{margin-top:8px;font-size:13px;color:#ffb3b3}

    /* custom currency toggle */
    .currency-toggle{display:flex;gap:8px;margin-top:8px}
    .currency-toggle button{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef6;cursor:pointer}
    .currency-toggle button.active{background:#07263a;color:#fff;border-color:rgba(125,211,252,0.28);box-shadow:0 4px 14px rgba(7,38,58,0.6)}
    .info-line{color:var(--muted-weak);margin-top:10px}

    /* NAV always visible and mobile-friendly */
    nav#mainNav {
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      max-width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding: 6px 0;
    }
    nav#mainNav a { white-space: nowrap; color: #e6eef6; text-decoration: none; padding:8px 10px; border-radius:10px; transition: all .12s; }
    nav#mainNav a:hover, nav#mainNav a:active { color:#fff; background: rgba(255,255,255,0.03); }
    nav#mainNav a.btn { color: #0b1220; }

    @media(max-width:900px){
      header { align-items:flex-start; gap:10px; }
      nav#mainNav { padding-left: 6px; padding-right:6px; margin-top:8px; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="brand" role="banner">
        <div class="logo" aria-label="GENZ logo">
          <img src="./img/IMG_0605.PNG" alt="GENZ logo">
        </div>
        <div>
          <div class="title">GENZ — Presale</div>
          <div class="sub">Nickname: <strong>GENZ</strong></div>
        </div>
      </div>

      <!-- main nav: всегда видно, touch-friendly -->
      <nav role="navigation" aria-label="Top navigation" id="mainNav">
        <a href="#tokenomics" class="nav-link">Tokenomics</a>
        <a href="#roadmap" class="nav-link">Roadmap</a>
        <a href="#faq" class="nav-link">FAQ</a>
        <a class="btn nav-link" href="#buy" id="navBuy">Buy</a>
      </nav>
    </header>

    <main class="grid">
      <section>
        <div class="card">
          <h1>GENZ — next-generation meme coin</h1>
          <p class="lead">GENZ — memecoin for the new generation. This is the official presale page. Presale opens soon on Solana. Verify the contract address below before participating; never share private keys.</p>

          <div class="stats">
            <div class="stat">
              <small>Soft cap</small>
              <strong>$10,000</strong>
            </div>
            <div class="stat">
              <small>Hard cap</small>
              <strong id="hardcap">$50,000</strong>
            </div>
          </div>

          <div class="progress">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="muted small">Raised</div>
              <div class="muted small">Target</div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
              <div><strong id="raised">$7,800</strong></div>
              <div><strong id="target">$50,000</strong></div>
            </div>
            <div class="bar" aria-hidden="true" style="margin-top:10px">
              <div class="bar-inner" id="barInner" style="width:15%"></div>
            </div>
            <div class="bar-row"><span id="pct">15%</span><span class="muted small">of hard cap</span></div>
          </div>

          <div style="margin-top:12px" id="buy">
            <div class="muted small">Presale status</div>
            <div class="countdown" id="countdown"><!-- JS fills --></div>

            <div class="tiers" style="margin-top:12px">
              <div class="tier">
                <div><strong>Seed</strong><div class="muted small">40% bonus · cap $5,000</div></div>
                <div class="right"><div class="muted small">$0.01/token</div><button class="btn" id="seedBuy">Buy</button></div>
              </div>

              <div class="tier">
                <div><strong>Early Bird</strong><div class="muted small">25% bonus · cap $15,000</div></div>
                <div class="right"><div class="muted small">$0.02/token</div><button class="btn" id="earlyBuy">Buy</button></div>
              </div>

              <div class="tier">
                <div><strong>Public</strong><div class="muted small">0% · cap $30,000</div></div>
                <div class="right"><div class="muted small">$0.03/token</div><button class="btn" id="publicBuy">Buy</button></div>
              </div>
            </div>

            <p class="muted small" style="margin-top:8px">Use the Connect wallet button to participate when presale is live. All purchases interact with the verified presale contract on Solana. Never share private keys.</p>
            <div id="walletNotice"></div>
          </div>
        </div>

        <div class="card" style="margin-top:16px" id="tokenomics">
          <h3>Tokenomics</h3>
          <p class="muted small">Transparency &gt; hype. Example allocation below.</p>
          <table>
            <tr><td>Total Supply</td><td class="right">1,000,000,000</td></tr>
            <tr><td>Presale</td><td class="right">20%</td></tr>
            <tr><td>Liquidity</td><td class="right">30%</td></tr>
            <tr><td>Team (vesting)</td><td class="right">10%</td></tr>
            <tr><td>Marketing / Growth</td><td class="right">20%</td></tr>
            <tr><td>Airdrop / Community</td><td class="right">10%</td></tr>
          </table>
        </div>

        <div class="card" style="margin-top:16px" id="roadmap">
          <h3>Roadmap</h3>
          <ol class="muted small">
            <li>Presale & private listings</li>
            <li>CEX / DEX listings, liquidity add</li>
            <li>Marketing push, community events, merch</li>
          </ol>
        </div>

        <div class="card" style="margin-top:16px" id="faq">
          <h3>FAQ</h3>
          <details>
            <summary>How do I verify the contract?</summary>
            <div class="muted small" style="margin-top:8px">Copy the contract address and check its code and transactions on Solscan. The official verified address will be published prior to presale.</div>
          </details>
          <details style="margin-top:8px">
            <summary>How do I participate?</summary>
            <div class="muted small" style="margin-top:8px">Connect a wallet (Phantom for SOL). Use the Buy buttons to pay. Do not share private keys.</div>
          </details>
        </div>
      </section>

      <aside>
        <div class="card">
          <h3>Subscribe</h3>
          <p class="muted small">Subscribe for whitelist alerts, contract publication and official announcements.</p>
          <form id="subscribeForm" class="subscribe" onsubmit="return false">
            <input id="email" class="input" placeholder="Email" />
            <button id="subBtn" class="btn">Subscribe</button>
          </form>
          <div id="subMsg" class="muted small" style="margin-top:8px"></div>

          <div style="margin-top:12px">
            <h4>Quick facts</h4>
            <div class="muted small">SOL address: <span id="contractAddr">7Ton9ubUjbGX3bLrh1g2KBXCdBFjJQG8HDhDfboVwWFy</span></div>
            <div class="muted small" style="margin-top:6px">USDT (Polygon): 0x37D5675003ed3D97734aB92a9CEf8bD3F694531d</div>
            <div class="muted small" style="margin-top:6px">BTC: bc1q9vdyrf5fs2yjkguewlg4cvzzccfpcctlxdmx6z</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4>Disclaimer</h4>
          <p class="muted small">GENZ presale page. Not financial advice. Verify transactions on Solana explorer / Polygon explorer before assuming anything.</p>
        </div>
      </aside>
    </main>

    <footer>
      <div class="muted small">© 2025 GENZ — all rights reserved.</div>
    </footer>
  </div>

  <script>
    // UI initial values
    const CONFIG = {
      PRESALE_START: '2025-10-01T12:00:00Z',
      PRESALE_END: '2025-10-15T12:00:00Z',
      PRESALE_TARGET_USD: 50000,
      RAISED_USD: 7800,
    };
    document.getElementById('hardcap').textContent = '$' + CONFIG.PRESALE_TARGET_USD.toLocaleString();
    document.getElementById('raised').textContent = '$' + CONFIG.RAISED_USD.toLocaleString();
    document.getElementById('target').textContent = '$' + CONFIG.PRESALE_TARGET_USD.toLocaleString();
  </script>

  <!-- Purchase script (Phantom + copy fallback). Полностью touch-friendly. -->
  <script type="module">
  import { Connection, PublicKey, SystemProgram, Transaction, TransactionInstruction } from 'https://esm.sh/@solana/web3.js@1.77.0';

  const SOL_PROJECT_ADDRESS = new PublicKey('7Ton9ubUjbGX3bLrh1g2KBXCdBFjJQG8HDhDfboVwWFy');
  const USDT_POLY_ADDRESS = '0x37D5675003ed3D97734aB92a9CEf8bD3F694531d';
  const BTC_ADDRESS = 'bc1q9vdyrf5fs2yjkguewlg4cvzzccfpcctlxdmx6z';
  const RPC_ENDPOINT = 'https://api.mainnet-beta.solana.com';
  const connection = new Connection(RPC_ENDPOINT, 'confirmed');

  const PRICE_PER_GENZ_USD = 0.0001;
  const COINGECKO_SIMPLE_PRICE = 'https://api.coingecko.com/api/v3/simple/price?ids=solana,bitcoin&vs_currencies=usd';
  const TIER_USD = { seed: 50, early: 25, public: 10 };

  const enc = s => new TextEncoder().encode(String(s));
  const uuidv4 = () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{ const r=Math.random()*16|0; const v = c==='x'? r : (r&0x3|0x8); return v.toString(16); });

  function getPhantomProvider(){
    const w = window;
    if (!w.solana) return null;
    if (w.solana.isPhantom) return w.solana;
    if (Array.isArray(w.solana.providers)) return w.solana.providers.find(p=>p.isPhantom) || w.solana.providers[0];
    return w.solana;
  }

  function memoInstruction(purchaseId){
    const PROGRAM_ID = new PublicKey('MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLmfcHr');
    return new TransactionInstruction({ keys: [], programId: PROGRAM_ID, data: enc(purchaseId) });
  }

  async function loadPrices(){
    try{
      const r = await fetch(COINGECKO_SIMPLE_PRICE);
      const j = await r.json();
      return { sol: j.solana?.usd || null, btc: j.bitcoin?.usd || null };
    }catch(e){
      console.warn('price load fail', e);
      return { sol: null, btc: null };
    }
  }

  async function createAndSendSolTx(provider, solAmount, purchaseId){
    if (!provider) throw new Error('no_provider');
    if (!provider.publicKey) throw new Error('no_pubkey');

    const lamports = Math.round(Number(solAmount) * 1e9);
    if (lamports <= 0) throw new Error('invalid_amount');

    const tx = new Transaction();
    tx.add(SystemProgram.transfer({
      fromPubkey: provider.publicKey,
      toPubkey: SOL_PROJECT_ADDRESS,
      lamports
    }));
    tx.add(memoInstruction(purchaseId));

    const { blockhash } = await connection.getLatestBlockhash('finalized');
    tx.recentBlockhash = blockhash;
    tx.feePayer = provider.publicKey;

    if (provider.signAndSendTransaction) {
      const signed = await provider.signAndSendTransaction(tx);
      await connection.confirmTransaction(signed.signature, 'confirmed');
      return signed.signature;
    } else if (provider.signTransaction) {
      const signedTx = await provider.signTransaction(tx);
      const raw = signedTx.serialize();
      const sig = await connection.sendRawTransaction(raw);
      await connection.confirmTransaction(sig, 'confirmed');
      return sig;
    } else {
      throw new Error('wallet_missing_sign_methods');
    }
  }

  async function robustCopy(text){
    try{
      if (navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(text);
        return true;
      }
    }catch(e){ console.warn('clipboard API failed', e); }
    try{
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, ta.value.length);
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      return ok;
    }catch(e){ console.warn('execCommand copy failed', e); return false; }
  }

  // openBuyModal: touch-friendly, custom currency buttons, Phantom universal link and copy fallback
  function openBuyModal({ autoTier=null } = {}) {
    if (document.getElementById('__genz_modal')) return;
    const overlay = document.createElement('div'); overlay.className = 'genz-modal-overlay'; overlay.id='__genz_modal';
    const box = document.createElement('div'); box.className = 'genz-modal';
    const close = document.createElement('div'); close.className='genz-close'; close.textContent='✕'; close.onclick = ()=> overlay.remove();
    const title = document.createElement('h3'); title.textContent = 'Buy GENZ';
    const desc = document.createElement('div'); desc.className='genz-small'; desc.textContent = `GENZ price = $${PRICE_PER_GENZ_USD} / token. Токены начисляются вручную после пресейла.`;

    // currency toggle (custom)
    const currencyToggle = document.createElement('div'); currencyToggle.className = 'currency-toggle';
    const btnSOL = document.createElement('button'); btnSOL.type='button'; btnSOL.textContent='SOL'; btnSOL.dataset.currency='SOL';
    const btnUSDT = document.createElement('button'); btnUSDT.type='button'; btnUSDT.textContent='USDT'; btnUSDT.dataset.currency='USDT';
    const btnBTC = document.createElement('button'); btnBTC.type='button'; btnBTC.textContent='BTC'; btnBTC.dataset.currency='BTC';
    currencyToggle.appendChild(btnSOL); currencyToggle.appendChild(btnUSDT); currencyToggle.appendChild(btnBTC);

    const usdInput = document.createElement('input'); usdInput.className='genz-input'; usdInput.type='number'; usdInput.placeholder='Сумма в USD (напр. 10)';
    const cryptoInput = document.createElement('input'); cryptoInput.className='genz-input'; cryptoInput.type='number'; cryptoInput.placeholder='Либо сумма в крипто (напр. 0.01)';
    const infoLine = document.createElement('div'); infoLine.className='info-line'; infoLine.textContent='Загрузка курсов...';
    const resultLine = document.createElement('div'); resultLine.style.fontWeight='700'; resultLine.style.marginTop='8px'; resultLine.textContent='GENZ: —';
    const payRow = document.createElement('div'); payRow.style.marginTop='12px';
    const btnPay = document.createElement('button'); btnPay.className='genz-btn'; btnPay.textContent='Pay with SOL (Phantom)';
    const btnOpenPhantom = document.createElement('button'); btnOpenPhantom.className='genz-secondary'; btnOpenPhantom.textContent='Open in Phantom';
    const btnCopy = document.createElement('button'); btnCopy.className='genz-secondary'; btnCopy.textContent='Copy address (USDT/BTC)';
    payRow.appendChild(btnPay); payRow.appendChild(btnOpenPhantom); payRow.appendChild(btnCopy);

    box.appendChild(close); box.appendChild(title); box.appendChild(desc);
    box.appendChild(currencyToggle);
    box.appendChild(usdInput); box.appendChild(cryptoInput);
    box.appendChild(infoLine); box.appendChild(resultLine); box.appendChild(payRow);
    overlay.appendChild(box); document.body.appendChild(overlay);

    // state
    let prices = { sol:null, btc:null };
    let currentCurrency = 'SOL';
    function setActiveCurrency(c){
      currentCurrency = c;
      [btnSOL,btnUSDT,btnBTC].forEach(b=> b.classList.toggle('active', b.dataset.currency===c));
      recompute();
    }
    async function refreshPrices(){ prices = await loadPrices(); infoLine.textContent = `Курсы: SOL ≈ $${prices.sol ?? 'n/a'}, BTC ≈ $${prices.btc ?? 'n/a'}`; recompute(); }
    refreshPrices();

    function recompute(){
      const cur = currentCurrency;
      const usd = parseFloat(usdInput.value||'0');
      const crypto = parseFloat(cryptoInput.value||'0');
      let usdEffective = usd;
      if (crypto>0){
        if (cur==='SOL' && prices.sol) usdEffective = crypto * prices.sol;
        else if (cur==='BTC' && prices.btc) usdEffective = crypto * prices.btc;
        else if (cur==='USDT') usdEffective = crypto;
        else usdEffective = 0;
      }
      const genz = usdEffective>0 ? Math.floor(usdEffective / PRICE_PER_GENZ_USD) : 0;
      resultLine.textContent = `GENZ: ${genz.toLocaleString()} (≈ $${usdEffective.toFixed(2)}) — Валюта: ${cur}`;
    }

    // currency button handlers (touch/click/pointer)
    [btnSOL,btnUSDT,btnBTC].forEach(b=>{
      const handler = (ev) => { ev.preventDefault(); setActiveCurrency(b.dataset.currency); };
      b.addEventListener('click', handler);
      b.addEventListener('touchend', handler);
      b.addEventListener('pointerdown', handler);
    });

    usdInput.oninput = ()=> { cryptoInput.value=''; recompute(); };
    cryptoInput.oninput = ()=> { usdInput.value=''; recompute(); };

    if (autoTier && TIER_USD[autoTier]) { usdInput.value = TIER_USD[autoTier]; setActiveCurrency('SOL'); recompute(); setTimeout(()=> tryAutoPay(currentCurrency, usdInput, cryptoInput, resultLine), 350); }

    // pay actions
    btnPay.addEventListener('click', async ()=> { await tryAutoPay(currentCurrency, usdInput, cryptoInput, resultLine); });
    btnPay.addEventListener('touchend', async (e)=>{ e.preventDefault(); await tryAutoPay(currentCurrency, usdInput, cryptoInput, resultLine); });

    btnOpenPhantom.addEventListener('click', async ()=>{
      if (currentCurrency !== 'SOL') { resultLine.textContent = 'Open in Phantom доступен только для SOL.'; return; }
      let usd = parseFloat(usdInput.value||'0');
      let crypto = parseFloat(cryptoInput.value||'0');
      let solAmount = 0;
      if (crypto>0) solAmount = crypto;
      else if (usd>0 && prices.sol) solAmount = usd / prices.sol;
      else { resultLine.textContent = 'Введите сумму в USD или SOL.'; return; }
      // universal link to open Phantom on mobile
      const phantomUrl = `https://phantom.app/ul/transfer?address=${SOL_PROJECT_ADDRESS.toString()}&amount=${encodeURIComponent(solAmount)}`;
      // open
      window.location.href = phantomUrl;
    });
    btnOpenPhantom.addEventListener('touchend', (e)=>{ e.preventDefault(); btnOpenPhantom.click(); });

    btnCopy.addEventListener('click', async ()=>{
      if (currentCurrency === 'USDT'){
        const ok = await robustCopy(USDT_POLY_ADDRESS);
        resultLine.textContent = ok ? 'USDT (Polygon) адрес скопирован.' : 'Не удалось скопировать адрес. Скопируй вручную: ' + USDT_POLY_ADDRESS;
      } else if (currentCurrency === 'BTC'){
        const ok = await robustCopy(BTC_ADDRESS);
        resultLine.textContent = ok ? 'BTC адрес скопирован.' : 'Не удалось скопировать адрес. Скопируй вручную: ' + BTC_ADDRESS;
      } else {
        const ok = await robustCopy(SOL_PROJECT_ADDRESS.toString());
        resultLine.textContent = ok ? 'SOL адрес скопирован.' : 'Не удалось скопировать адрес. Скопируй вручную: ' + SOL_PROJECT_ADDRESS.toString();
      }
    });

    async function tryAutoPay(cur, usdInputEl, cryptoInputEl, resultEl){
      try{
        if (cur !== 'SOL') { resultEl.textContent = 'Pay with SOL доступен только для SOL. Для других валют — копируйте адрес.'; return; }
        const provider = getPhantomProvider();
        if (!provider) { resultEl.textContent = 'Phantom не найден. Нажмите "Open in Phantom" или скопируйте адрес.'; return; }
        if (!provider.isConnected) { try { await provider.connect(); } catch(e){ resultEl.textContent = 'Подключение кошелька отменено.'; return; } }
        const usd = parseFloat(usdInputEl.value || '0');
        const crypto = parseFloat(cryptoInputEl.value || '0');
        let solAmount = 0;
        if (crypto>0) solAmount = crypto;
        else if (usd>0){
          if (!prices.sol) { resultEl.textContent = 'Курс SOL не загружен — попробуйте чуть позже.'; return; }
          solAmount = usd / prices.sol;
        } else { resultEl.textContent = 'Введите сумму в USD или SOL.'; return; }

        const purchaseId = uuidv4();
        resultEl.textContent = 'Создаю и подписываю транзакцию...';
        const sig = await createAndSendSolTx(provider, solAmount, purchaseId);
        resultEl.textContent = `Транзакция отправлена: ${sig}. purchaseId: ${purchaseId}`;
        // POST to backend here if exists
      } catch(err){
        console.error('autoPay err', err);
        resultEl.textContent = 'Ошибка: ' + (err.message || err.toString());
      }
    }
  } // end openBuyModal

  // Attach buy buttons (touch/click safe) and nav Buy
  function attachBuyButtons(){
    const map = { seedBuy:'seed', earlyBuy:'early', publicBuy:'public' };
    Object.keys(map).forEach(id=> {
      const btn = document.getElementById(id);
      if (btn) {
        const handler = (e) => { e.preventDefault(); openBuyModal({ autoTier: map[id] }); };
        btn.addEventListener('click', handler);
        btn.addEventListener('touchend', handler);
        btn.addEventListener('pointerdown', (ev)=>{ ev.preventDefault(); });
      }
    });
    const navBuy = document.getElementById('navBuy');
    if (navBuy) {
      const handler = (e) => { e.preventDefault(); openBuyModal({ autoTier: null }); };
      navBuy.addEventListener('click', handler);
      navBuy.addEventListener('touchend', handler);
    }
  }
  attachBuyButtons();

  // subscribe form minimal
  document.getElementById('subscribeForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    if (!email) { document.getElementById('subMsg').textContent = 'Введите email.'; return; }
    document.getElementById('subMsg').textContent = 'Подписка принята (заглушка).';
  });

  console.log('GENZ presale script loaded (mobile-friendly nav)');
  </script>

  <!-- Small helper: if nav was hidden by old CSS, force visible on load (failsafe) -->
  <script>
    (function(){
      const nav = document.getElementById('mainNav');
      if (nav) { nav.style.display = 'flex'; nav.style.visibility = 'visible'; }
    })();
  </script>
</body>
</html>
